/**
 * @license
 * pushbullet-tasker.js
 *
 * Versión: 1.0.0
 * Date: 2016-07-22
 *
 * © 2016 Cristian Moncho Ivorra
 * @license https://www.gnu.org/licenses/lgpl-3.0.txt
 */

if("undefined"==typeof tk)var tk={local:function(){},global:function(){},flashLong:console.log};var PB=function(e,t,n){"use strict";function r(n,r){var o=s("POST",d,{"Access-Token":p.token});if(r.type=n,o.send(l(r)),p.debug&&e.flashLong(o.responseText),o.status!==_.OK)throw new t.Error("Unable to push data: "+o.status);return o.responseText}function o(n,r){var o=s("POST",b,{"Access-Token":p.token});if(o.send(l({file_name:n,file_type:r})),p.debug&&e.flashLong(o.responseText),o.status!==_.OK)throw new t.Error("Unable to request upload URL: "+o.status);return JSON.parse(o.responseText)}function u(e){var n=s("GET",e);n.overrideMimeType("text/plain; charset=x-user-defined"),n.send();for(var r=n.responseText,o=new t.Uint8Array(r.length),u=0,i=r.length;i>u;u++)o[u]=r.charCodeAt(u);return new t.Blob([o])}function i(e,n,r){var i=o(e,n),a=s("POST",i.upload_url);if(a.send(l({file:u(r)})),a.status!==_.NO_CONTENT)throw new t.Error("Unable to upload file: "+a.status);return i.file_url}function l(e){var n=new t.FormData;for(var r in e)e.hasOwnProperty(r)&&n.append(r,e[r]);return n}function s(e,n,r){var o=new t.XMLHttpRequest;o.open(e.toUpperCase(),n,!1);for(var u in r||{})r.hasOwnProperty(u)&&o.setRequestHeader(u,r[u]);return o}function a(n,r){var o;if([t[n],e.local(n.toLowerCase()),e.global(n.toUpperCase()),r].some(function(e,t){return"undefined"!=typeof(o=e)}),"undefined"==typeof o)throw new t.Error('Undefined variable "'+n+'"!');return o}var p={},f="https://api.pushbullet.com/v2/",d=f+"pushes",b=f+"upload-request",_={OK:200,NO_CONTENT:204,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404};p.debug=a("pb_debug",!1),p.token=a("pb_token",null),p.pushNote=function(e){return e=e||{},r("note",{title:e.title||a("pb_title",""),body:e.body||a("pb_body","")})},p.pushLink=function(e){return e=e||{},r("link",{title:e.title||a("pb_title",""),body:e.body||a("pb_body",""),url:e.url||a("pb_url")})},p.pushFile=function(e){e=e||{};var t=e.file_name||a("pb_file_name"),n=e.file_path||a("pb_file_path"),o=e.file_type||a("pb_file_type");return r("file",{title:e.title||a("pb_title",""),body:e.body||a("pb_body",""),file_name:t,file_type:o,file_url:i(t,o,n)})};var h=a("pb_type",null);return h&&({note:p.pushNote,link:p.pushLink,file:p.pushFile}[h]||function(){throw Error("Unknown type: '"+h+"'!")})(),p}(tk,this);
